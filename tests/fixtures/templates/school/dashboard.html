# tests/fixtures/templates/school/dashboard.html
{% extends "base.html" %}
{% from "macros/navigation.html" import breadcrumb_nav %}
{% from "macros/course_components.html" import course_card %}

{% block title %}{{ object.name }} - Dashboard{% endblock %}
{% block page_title %}{{ object.name }} Dashboard{% endblock %}

{% block content %}
{{ breadcrumb_nav([
    {"name": "Schools", "url": "/schools"}, 
    {"name": object.name, "url": "#", "active": true}
]) }}

<div class="card">
    <h2>School Overview</h2>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 15px 0;">
        <div>
            <p><strong>School Name:</strong> {{ object.name }}</p>
            <p><strong>Address:</strong> {{ object.address }}</p>
            <p><strong>School ID:</strong> {{ object.id }}</p>
        </div>
        <div>
            <p><strong>Total Courses:</strong> {{ object.courses | length if object.courses else 0 }}</p>
            <p><strong>Active Courses:</strong> {{ object.courses | selectattr('status', 'equalto', 'ACTIVE') | list | length if object.courses else 0 }}</p>
            <p><strong>Total Students:</strong> 
                {% set total_students = [] %}
                {% if object.courses %}
                    {% for course in object.courses %}
                        {% if course.students %}
                            {% for student in course.students %}
                                {% if student not in total_students %}
                                    {% set _ = total_students.append(student) %}
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                    {% endfor %}
                {% endif %}
                {{ total_students | length }}
            </p>
        </div>
    </div>
</div>

{% if object.courses %}
<div class="card">
    <h3>Courses Offered</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
        {% for course in object.courses %}
            {{ course_card(course) }}
        {% endfor %}
    </div>
</div>
{% else %}
<div class="card">
    <h3>No Courses Available</h3>
    <p>This school currently has no courses configured.</p>
    <a href="/schools/{{ object.id }}/courses/new" class="btn">Add First Course</a>
</div>
{% endif %}

<div class="card">
    <h3>Quick Actions</h3>
    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
        <a href="/schools/{{ object.id }}/courses" class="btn">Manage Courses</a>
        <a href="/schools/{{ object.id }}/students" class="btn">View Students</a>
        <a href="/schools/{{ object.id }}/reports" class="btn">View Reports</a>
        <a href="/schools/{{ object.id }}/settings" class="btn" style="background: #6c757d;">School Settings</a>
    </div>
</div>

{% if debug_mode %}
<div class="debug-info">
    <strong>Object Debug:</strong>
    <pre>Type: {{ object.__class__.__name__ }}
ID: {{ object.id }}
Name: {{ object.name }}
Courses Count: {{ object.courses | length if object.courses else 0 }}</pre>
</div>
{% endif %}
{% endblock %}